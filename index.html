<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>五大信念字謎挑戰</title>
    <style>
        :root { --primary: #003a70; }
        body { font-family: "Microsoft JhengHei", sans-serif; margin: 0; padding: 10px; text-align: center; background: #f4f7f9; touch-action: none; }
        #info-bar { background: white; padding: 10px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #grid-container { 
            display: grid; 
            grid-template-columns: repeat(12, 1fr); 
            gap: 1px; 
            background: #ccc; 
            border: 2px solid var(--primary);
            margin: 0 auto;
            width: 90vw;
            max-width: 480px;
            user-select: none;
        }
        .cell { 
            background: white; 
            aspect-ratio: 1;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            font-size: 4vw; 
            border: 0.1px solid #eee;
        }
        @media (min-width: 480px) { .cell { font-size: 20px; } }
        .selected { background: #ffeb3b !important; }
        .found { background: #4caf50 !important; color: white; }
        #word-list { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 15px; padding: 10px; background: #fff; font-size: 13px; text-align: left; }
        .word-found { text-decoration: line-through; color: #ccc; }
    </style>
</head>
<body>

    <div id="info-bar">
        <strong>尋寶進度: <span id="count">0</span> / 15</strong><br>
        時間: <span id="timer">0</span> 秒
    </div>

    <div id="grid-container"></div>
    <div id="word-list"></div>

    <script>
        const words = ["以客為尊", "創新與科技", "卓越服務", "團隊精神", "精益求精", "無微不至", "體貼入微", "推陳出新", "與時俱進", "一絲不苟", "貼心周到", "同舟共濟", "團結一心", "力求完美", "學無止境"];
        
        // 重新排列後的 144 個字，確保冇格式錯誤
        const gridRows = [
            "以客為尊步步高一絲不苟興",
            "萬事興創意無限好運來喜樂",
            "推陳出新歡天喜地笑口常開",
            "快樂團與時俱進恭喜發財旺",
            "幸福結科鴻運當頭百事可樂",
            "美體一技夢成真團隊精神棒",
            "愛貼心周到處處生機益多福",
            "學入平安喜樂順利力求完美",
            "無微不至錦上添花樂精無憂",
            "止氣東來同舟共濟年年有餘",
            "境隨心轉萬事勝意前程似錦",
            "心想事成福氣滿卓越服務讚"
        ];
        const rawGrid = gridRows.join("");
        const gridArray = rawGrid.split("");
        
        const container = document.getElementById('grid-container');
        const foundWords = new Set();
        let seconds = 0;

        // 1. 生成矩陣 (確保呢部分運行)
        gridArray.forEach((char, i) => {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.innerText = char;
            cell.setAttribute('data-index', i);
            container.appendChild(cell);
        });

        // 2. 生成清單
        const listContainer = document.getElementById('word-list');
        words.forEach(w => {
            const div = document.createElement('div');
            div.id = 'word-' + w;
            div.innerText = "• " + w;
            listContainer.appendChild(div);
        });

        // 3. 計時
        const timerObj = setInterval(() => {
            seconds++;
            document.getElementById('timer').innerText = seconds;
        }, 1000);

        // 4. 滑動邏輯
        let isSelecting = false;
        let selectedIndices = [];

        function handleStart(e) {
            isSelecting = true;
            selectedIndices = [];
            handleMove(e.touches ? e.touches[0] : e);
        }

        function handleMove(e) {
            if (!isSelecting) return;
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            const el = document.elementFromPoint(x, y);
            
            if (el && el.classList.contains('cell')) {
                const idx = parseInt(el.getAttribute('data-index'));
                if (!selectedIndices.includes(idx)) {
                    selectedIndices.push(idx);
                    el.classList.add('selected');
                }
            }
        }

        function handleEnd() {
            if (!isSelecting) return;
            isSelecting = false;
            const currentString = selectedIndices.map(i => gridArray[i]).join("");
            const reversedString = currentString.split("").reverse().join("");
            
            let found = words.includes(currentString) ? currentString : (words.includes(reversedString) ? reversedString : "");

            if (found && !foundWords.has(found)) {
                foundWords.add(found);
                selectedIndices.forEach(i => container.children[i].classList.add('found'));
                document.getElementById('word-' + found).classList.add('word-found');
                document.getElementById('count').innerText = foundWords.size;
                if (foundWords.size === words.length) {
                    clearInterval(timerObj);
                    alert("完成！用了 " + seconds + " 秒！");
                }
            }
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));
        }

        container.addEventListener('touchstart', handleStart);
        window.addEventListener('touchmove', handleMove, {passive: false});
        window.addEventListener('touchend', handleEnd);
        container.addEventListener('mousedown', handleStart);
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('mouseup', handleEnd);
    </script>
</body>
</html>