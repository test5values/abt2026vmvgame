<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº”å¤§ä¿¡å¿µçŒœå­—è¬æŒ‘æˆ°</title>
    <style>
        :root { --primary: #003a70; }
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            margin: 0; 
            padding: 10px 10px 50px 10px; 
            text-align: center; 
            background: skyblue; 
            touch-action: pan-y; 
            overflow-x: hidden; 
        }
        
        h1 {
            color: var(--primary);
            margin: 10px 0 15px 0;
            font-size: 6vw;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }
        @media (min-width: 480px) { h1 { font-size: 32px; } }

        #info-bar { background: white; padding: 10px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        #submit-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #submit-btn:active { background: #218838; transform: translateY(2px); }

        #grid-container { 
            display: grid; 
            grid-template-columns: repeat(12, 1fr); 
            gap: 1px; 
            background: #ccc; 
            border: 2px solid var(--primary);
            margin: 0 auto;
            width: 90vw;
            max-width: 480px;
            user-select: none;
            touch-action: none;
        }
        .cell { 
            background: white; 
            aspect-ratio: 1;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            font-size: 4vw;
        }
        @media (min-width: 480px) { .cell { font-size: 20px; } }
        .selected { background: #ffeb3b !important; }
        .found { background: #4caf50 !important; color: white; }
        
        #word-list { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 15px; padding: 10px; background: #fff; font-size: 13px; text-align: left; border-radius: 8px; }
        .word-found { text-decoration: line-through; color: #ccc; }

        #instruction-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px auto;
            width: 90vw;
            max-width: 480px;
            text-align: left;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 14px;
            line-height: 1.6;
            color: #333;
        }
        #instruction-box h3 {
            margin-top: 0;
            color: var(--primary);
            text-align: center;
            border-bottom: 2px solid #f4f7f9;
            padding-bottom: 10px;
            font-size: 18px;
        }
        #instruction-box ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
    </style>
</head>
<body>

    <h1>é¦™æ¸¯ä»”éš§é“äº”å¤§ä¿¡å¿µçŒœå­—è¬æŒ‘æˆ°</h1>

    <div id="info-bar">
        <strong>å®Œæˆé€²åº¦: <span id="count">0</span> / 15</strong><br>
        æ™‚é–“: <span id="timer">0</span> ç§’
    </div>

    <button id="submit-btn" onclick="manualSubmit()">çµæŸä¸¦æäº¤æˆç¸¾</button>
    
    <div id="grid-container"></div>
    
    <p style="font-size:12px; color:#555; margin-top:5px;">(å¦‚éœ€æŸ¥çœ‹ä¸‹æ–¹å…§å®¹ï¼Œè«‹è§¸ç¢°å…©å´ç©ºç™½è™•æ»‘å‹•)</p>

    <div id="instruction-box">
        <h3>ğŸ“– éŠæˆ²ç©æ³•</h3>
        <ul>
            <li>åœ¨å­—æµ·ä¸­æ‰¾å‡º <strong>5å€‹</strong> å…¬å¸æ ¸å¿ƒä¿¡å¿µåŠ <strong>10å€‹</strong> æ ¸å¿ƒä¿¡å¿µç›¸é—œæˆèªå…¶ä¸­ <strong>5å€‹</strong>ã€‚</li>
            <li>æ‰‹æŒ‡ï¼ˆæˆ–æ»‘é¼ ï¼‰<strong>æ©«å‘</strong> æˆ– <strong>ç›´å‘</strong> æ»‘å‹•é€£å­—ã€‚</li>
            <li>å¦‚æœ‰å›°é›£ï¼Œå¯åƒè€ƒä¸‹æ–¹çš„è©èªæ¸…å–®ã€‚</li>
            <li>å®ŒæˆæŒ‘æˆ°å¾Œï¼ŒæŒ‰ç¶ è‰²æŒ‰éˆ•æäº¤æˆç¸¾ã€‚</li>
        </ul>
    </div>

    <div id="word-list"></div>

    <script>
        // â–¼â–¼â–¼ å·²å¡«å¥½ä½ çš„ç¶²å€ â–¼â–¼â–¼
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx0FpNFxYRXQXys69CcqZeLIKf_-Xkkup1VnxsF8QO-4VxgptolyBr_RXlijFJvXlm2/exec"; 
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        const words = ["ä»¥å®¢ç‚ºå°Š", "å‰µæ–°èˆ‡ç§‘æŠ€", "å“è¶Šæœå‹™", "åœ˜éšŠç²¾ç¥", "ç²¾ç›Šæ±‚ç²¾", "ç„¡å¾®ä¸è‡³", "é«”è²¼å…¥å¾®", "æ¨é™³å‡ºæ–°", "èˆ‡æ™‚ä¿±é€²", "ä¸€çµ²ä¸è‹Ÿ", "è²¼å¿ƒå‘¨åˆ°", "åŒèˆŸå…±æ¿Ÿ", "åœ˜çµä¸€å¿ƒ", "åŠ›æ±‚å®Œç¾", "å­¸ç„¡æ­¢å¢ƒ"];
        
        const gridRows = [
            "ä»¥å®¢ç‚ºå°Šæ­¥æ­¥é«˜ä¸€çµ²ä¸è‹Ÿèˆˆ",
            "è¬äº‹èˆˆå‰µæ„ç„¡é™å¥½é‹ä¾†å–œæ¨‚",
            "æ¨é™³å‡ºæ–°æ­¡å¤©å–œåœ°ç¬‘å£å¸¸é–‹",
            "å¿«æ¨‚åœ˜èˆ‡æ™‚ä¿±é€²æ­å–œç™¼è²¡æ—º",
            "å¹¸ç¦çµç§‘é´»é‹ç•¶é ­ç™¾äº‹å¯æ¨‚",
            "ç¾é«”ä¸€æŠ€å¤¢æˆçœŸåœ˜éšŠç²¾ç¥æ£’",
            "æ„›è²¼å¿ƒå‘¨åˆ°è™•è™•ç”Ÿæ©Ÿç›Šå¤šç¦",
            "å­¸å…¥å¹³å®‰å–œæ¨‚é †åˆ©åŠ›æ±‚å®Œç¾",
            "ç„¡å¾®ä¸è‡³éŒ¦ä¸Šæ·»èŠ±æ¨‚ç²¾ç„¡æ†‚",
            "æ­¢æ°£æ±ä¾†åŒèˆŸå…±æ¿Ÿå¹´å¹´æœ‰é¤˜",
            "å¢ƒéš¨å¿ƒè½‰è¬äº‹å‹æ„å‰ç¨‹ä¼¼éŒ¦",
            "å¿ƒæƒ³äº‹æˆç¦æ°£æ»¿å“è¶Šæœå‹™è®š",
            "å¥½äººä¸€ç”Ÿå¹³å®‰é¾é¦¬ç²¾ç¥å¤§å‰"
        ];

        let rawString = gridRows.join("");
        const gridArray = rawString.split("");
        
        const container = document.getElementById('grid-container');
        const foundWords = new Set();
        let seconds = 0;
        let gameEnded = false;

        gridArray.forEach((char, i) => {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.innerText = char;
            cell.setAttribute('data-index', i);
            container.appendChild(cell);
        });

        const listContainer = document.getElementById('word-list');
        words.forEach(w => {
            const div = document.createElement('div');
            div.id = 'word-' + w;
            div.innerText = "â€¢ " + w;
            listContainer.appendChild(div);
        });

        let timerRunning = true;
        const timerObj = setInterval(() => {
            if(timerRunning && !gameEnded) {
                seconds++;
                document.getElementById('timer').innerText = seconds;
            }
        }, 1000);

        let isSelecting = false;
        let startIdx = -1;
        let selectedIndices = [];

        function handleStart(e) {
            if(gameEnded) return;
            const t = e.touches ? e.touches[0] : e;
            const el = document.elementFromPoint(t.clientX, t.clientY);
            
            if (el && el.classList.contains('cell')) {
                if(e.cancelable && e.type === 'touchstart') e.preventDefault();
                isSelecting = true;
                startIdx = parseInt(el.getAttribute('data-index'));
                selectedIndices = [startIdx];
                el.classList.add('selected');
            }
        }

        function handleMove(e) {
            if (!isSelecting || gameEnded) return;
            if(e.cancelable) e.preventDefault();

            const t = e.touches ? e.touches[0] : e;
            const el = document.elementFromPoint(t.clientX, t.clientY);
            
            if (el && el.classList.contains('cell')) {
                const currentIdx = parseInt(el.getAttribute('data-index'));
                const sR = Math.floor(startIdx / 12), sC = startIdx % 12;
                const cR = Math.floor(currentIdx / 12), cC = currentIdx % 12;

                document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));
                selectedIndices = [];

                if (sR === cR) { // æ©«
                    for (let c = Math.min(sC, cC); c <= Math.max(sC, cC); c++) {
                        const idx = sR * 12 + c;
                        selectedIndices.push(idx);
                        container.children[idx].classList.add('selected');
                    }
                } else if (sC === cC) { // ç›´
                    for (let r = Math.min(sR, cR); r <= Math.max(sR, cR); r++) {
                        const idx = r * 12 + sC;
                        selectedIndices.push(idx);
                        container.children[idx].classList.add('selected');
                    }
                }
            }
        }

        function handleEnd() {
            if (!isSelecting || gameEnded) return;
            isSelecting = false;
            const str = selectedIndices.map(i => gridArray[i]).join("");
            const rev = str.split("").reverse().join("");
            let f = words.includes(str) ? str : (words.includes(rev) ? rev : "");

            if (f && !foundWords.has(f)) {
                foundWords.add(f);
                selectedIndices.forEach(i => container.children[i].classList.add('found'));
                document.getElementById('word-' + f).className = 'word-found';
                document.getElementById('count').innerText = foundWords.size;
                
                if (foundWords.size === words.length) {
                    timerRunning = false; 
                }
            }
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('selected'));
        }

        async function manualSubmit() {
            if(gameEnded) return alert("ä½ å·²ç¶“æäº¤éæˆç¸¾äº†ï¼");
            
            timerRunning = false;
            
            // â–¼â–¼â–¼ æ”¹ç”¨å‚³çµ±å­—ä¸²çµ„åˆï¼Œä¿è­‰ä¸æœƒå‡ºéŒ¯ â–¼â–¼â–¼
            let confirmMsg = "ä½ ç›®å‰æ‰¾åˆ°äº† " + foundWords.size + " / 15 å€‹ç­”æ¡ˆã€‚\næ‰€ç”¨æ™‚é–“ï¼š" + seconds + " ç§’ã€‚\nç¢ºå®šè¦ç¾åœ¨æäº¤å—ï¼Ÿ";
            
            if(!confirm(confirmMsg)) {
                timerRunning = true;
                return;
            }

            gameEnded = true;

            if(GOOGLE_SCRIPT_URL.includes("http")) {
                const userName = prompt("è«‹è¼¸å…¥æ‚¨çš„å§“åï¼š");
                const empId = prompt("è«‹è¼¸å…¥æ‚¨çš„å“¡å·¥ç·¨è™Ÿï¼š");
                
                // æ”¶é›†å·²æ‰¾åˆ°çš„å­—
                const foundListString = Array.from(foundWords).join("ã€");

                if(userName) {
                    document.getElementById('submit-btn').innerText = "æ­£åœ¨ä¸Šå‚³...";
                    document.getElementById('submit-btn').disabled = true;

                    try {
                        await fetch(GOOGLE_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                name: userName,
                                empId: empId,
                                score: foundWords.size + " / 15",
                                seconds: seconds,
                                foundList: foundListString
                            })
                        });
                        alert("âœ… æˆç¸¾å·²æˆåŠŸä¸Šå‚³ï¼æ„Ÿè¬åƒèˆ‡ï¼");
                        document.getElementById('submit-btn').innerText = "ä¸Šå‚³æˆåŠŸ";
                    } catch (error) {
                        alert("âš ï¸ ä¸Šå‚³å¤±æ•—ï¼Œè«‹æˆªåœ–çµ¦è² è²¬äººã€‚\nåˆ†æ•¸: " + foundWords.size + "\næ™‚é–“: " + seconds);
                        gameEnded = false;
                    }
                } else {
                    gameEnded = false;
                    alert("æ‚¨å–æ¶ˆäº†è¼¸å…¥ï¼Œè«‹é‡æ–°æŒ‰æäº¤ã€‚");
                }
            } else {
                alert("æ­å–œå®Œæˆï¼(å°šæœªè¨­å®šå¾Œå°ç¶²å€)");
            }
        }

        container.addEventListener('touchstart', handleStart, {passive: false});
        window.addEventListener('touchmove', handleMove, {passive: false});
        window.addEventListener('touchend', handleEnd);
        
        container.addEventListener('mousedown', handleStart);
        window.addEventListener('mousemove', handleMove);
        window.addEventListener('mouseup', handleEnd);
    </script>
</body>
</html>
